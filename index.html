<!DOCTYPE html>
<html lang="tr">
<head>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-9KFQ0B204M"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-9KFQ0B204M');
</script>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sınav Analiz Asistanı V8.0</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
<style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Playfair+Display:wght@700&display=swap');
    body{font-family:'Inter',sans-serif;background-color:#f8fafc;color:#334155}
    .fade-in{animation:fadeIn .4s ease-out}
    @keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
    .step-container{display:flex;gap:10px;background:#f1f5f9;padding:5px;border-radius:12px}
    .step-btn{flex:1;text-align:center;padding:10px;border-radius:8px;font-size:14px;font-weight:600;transition:all .2s;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:8px}
    .step-active{background:#fff;color:#2563eb;box-shadow:0 2px 4px rgba(0,0,0,.1);border:1px solid #e2e8f0}
    .step-inactive{color:#64748b;border:1px solid transparent}.step-inactive:hover{background:#e2e8f0}
    .mic-listening{animation:pulse-red 1.5s infinite;background-color:#ef4444!important;border-color:#ef4444!important;color:#fff!important}
    @keyframes pulse-red{0%{box-shadow:0 0 0 0 rgba(239,68,68,.7)}70%{box-shadow:0 0 0 12px rgba(239,68,68,0)}100%{box-shadow:0 0 0 0 rgba(239,68,68,0)}}
    @media (max-width: 768px) {
        #gradingTableBody tr {display: flex;flex-wrap: wrap;background: white;margin-bottom: 12px;border: 1px solid #e2e8f0;border-radius: 12px;padding: 10px;box-shadow: 0 2px 4px rgba(0,0,0,0.02);align-items: center;}
        #gradingTableBody tr.active-row {border: 2px solid #f59e0b !important;background-color: #fffbeb !important;transform: scale(1.02);transition: all 0.2s;}
        #section-entry thead { display: none; }
        #gradingTableBody td:first-child {width: 100%;border: none;border-bottom: 1px solid #f1f5f9;padding-bottom: 8px;margin-bottom: 8px;font-size: 1.1em;background: transparent !important;}
        #gradingTableBody td:not(:first-child):not(:last-child):not(:nth-last-child(2)) {width: 20%;border: none;padding: 2px;}
        #gradingTableBody td:nth-last-child(2), #gradingTableBody td:last-child {width: 50%;border: none;border-top: 1px solid #f1f5f9;margin-top: 8px;padding-top: 5px;background: transparent !important;}
        #gradingTableBody td:last-child { text-align: right; }
        input[type="number"] {background-color: #f8fafc;border: 1px solid #cbd5e1;height: 40px;border-radius: 6px;}
    }
    @media print {
        @page { size: A4; margin: 5mm; }
        html, body { height: auto; margin: 0 !important; padding: 0 !important; background: #fff; }
        body * { visibility: hidden; }
        #printableReport, #printableReport * { visibility: visible; }
        #printableReport { position: relative; left: 0; top: 0; width: 100%; margin: 0; padding: 0; display: block; }
        table { width: 100% !important; border-collapse: collapse !important; display: table !important; }
        thead { display: table-header-group !important; }
        tbody { display: table-row-group !important; }
        tr { display: table-row !important; page-break-inside: avoid; border: none !important; margin: 0 !important; box-shadow: none !important; padding: 0 !important; }
        th, td { display: table-cell !important; border: 1px solid #000 !important; padding: 4px !important; text-align: center; width: auto !important; }
        th { background-color: #f0f0f0 !important; font-weight: bold !important; -webkit-print-color-adjust: exact; }
        #topicAnalysisBody td { padding: 3px !important; font-size: 10pt !important; }
        #topicAnalysisBody td:first-child { text-align: left !important; }
        .page-break { page-break-before: always; display: block; }
        .no-break { break-inside: avoid; }
        canvas { max-height: 200px !important; width: 100% !important; }
        .no-print { display: none !important; }
        #sheetPage { margin-top: 20px; }
    }
    .modal-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.5);z-index:50;display:none;align-items:center;justify-content:center;backdrop-filter:blur(2px)}.modal-content{background:#fff;width:90%;max-width:600px;border-radius:16px;padding:24px;box-shadow:0 10px 25px rgba(0,0,0,.2);animation:popIn .3s}@keyframes popIn{from{opacity:0;transform:scale(.9)}to{opacity:1;transform:scale(1)}}
</style>
</head>
<body class="p-4 md:p-6 min-h-screen">
<div class="max-w-7xl mx-auto mb-6 no-print"><div class="bg-white p-4 rounded-2xl shadow-sm border border-slate-200 flex flex-col md:flex-row justify-between items-center gap-4"><div class="flex items-center gap-4 w-full md:w-auto"><img src="https://github.com/analizyapici/analiz/blob/main/logo.png?raw=true" alt="" class="w-16 h-16 object-contain hover:scale-105 transition-transform drop-shadow-md"><div><h1 class="text-xl font-bold text-slate-800">Sınav Analiz Asistanı <span class="text-xs bg-teal-600 text-white px-2 py-0.5 rounded-full ml-1">V8.0</span></h1><p class="text-slate-500 text-xs">Profesyonel Sürüm</p></div></div><div class="step-container w-full md:w-auto"><button onclick="_0xCore.show('setup')" id="nav-setup" class="step-btn step-active"><span class="w-6 h-6 rounded-full bg-slate-200 text-slate-600 flex items-center justify-center text-xs font-bold step-num">1</span> Kurulum</button><button onclick="_0xCore.show('entry')" id="nav-entry" class="step-btn step-inactive"><span class="w-6 h-6 rounded-full bg-slate-200 text-slate-600 flex items-center justify-center text-xs font-bold step-num">2</span> Not Girişi</button><button onclick="_0xCore.show('analysis')" id="nav-analysis" class="step-btn step-inactive"><span class="w-6 h-6 rounded-full bg-slate-200 text-slate-600 flex items-center justify-center text-xs font-bold step-num">3</span> Rapor</button></div><button onclick="document.getElementById('helpModal').style.display='flex'" class="text-slate-500 hover:text-blue-600 font-medium text-sm flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-slate-50 transition"><i class="fas fa-question-circle text-lg"></i> <span class="hidden md:inline">Yardım</span></button></div></div>
<div id="section-setup" class="max-w-7xl mx-auto space-y-6 fade-in"><div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200"><h2 class="text-lg font-bold text-slate-800 mb-4 border-b pb-2"><i class="fas fa-edit text-blue-500 mr-2"></i> Okul & Sınav Bilgileri</h2><div class="grid grid-cols-1 md:grid-cols-4 gap-4"><div><label class="block text-xs font-bold text-slate-500 mb-1">Okul Adı</label><input type="text" id="infoSchool" class="w-full border rounded-lg p-2 text-sm outline-none focus:border-blue-500" placeholder="Örn: Cumhuriyet Lisesi"></div><div><label class="block text-xs font-bold text-slate-500 mb-1">Öğretmen</label><input type="text" id="infoTeacher" class="w-full border rounded-lg p-2 text-sm outline-none focus:border-blue-500"></div><div><label class="block text-xs font-bold text-slate-500 mb-1">Ders</label><input type="text" id="infoLesson" class="w-full border rounded-lg p-2 text-sm outline-none focus:border-blue-500"></div><div><label class="block text-xs font-bold text-slate-500 mb-1">Yıl/Dönem</label><input type="text" id="infoYear" class="w-full border rounded-lg p-2 text-sm outline-none focus:border-blue-500" placeholder="2025-2026"></div></div></div><div class="grid grid-cols-1 lg:grid-cols-12 gap-6"><div class="lg:col-span-4 bg-white p-6 rounded-2xl shadow-sm border border-slate-200"><h2 class="text-lg font-bold text-slate-800 mb-2">A. Sınıf Ekle</h2><div class="space-y-3"><input type="text" id="batchClassName" class="w-full border-2 border-orange-100 bg-orange-50 rounded-lg p-2 text-sm font-bold text-orange-700 outline-none" placeholder="Sınıf Adı (Örn: 10-A)"><textarea id="studentPasteArea" class="w-full h-32 p-3 border rounded-lg bg-slate-50 text-sm outline-none resize-none" placeholder="E okuldan indirdiğiniz excel sınıf listesinden sadece öğrenci no,ad-soyad kısımlarını seçerek buraya yapıştırın ve sınıfı kaydedin...&#10;101 Ali Veli&#10;102 Ayşe Yılmaz"></textarea><button onclick="_0xCore.addSt()" class="w-full bg-slate-800 text-white py-2 rounded-lg text-sm font-bold hover:bg-slate-900 transition"><i class="fas fa-plus mr-2"></i>Sınıfı Kaydet</button><div id="addedClassesSummary" class="flex flex-wrap gap-2 pt-2"></div></div></div><div class="lg:col-span-8 bg-white p-6 rounded-2xl shadow-sm border border-slate-200"><div class="flex justify-between items-center mb-4"><h2 class="text-lg font-bold text-slate-800">B. Sorular</h2><span class="text-sm font-bold bg-blue-50 text-blue-700 px-3 py-1 rounded-lg">Toplam: <span id="totalPointsDisplay">0</span> Puan</span></div><div class="mb-2 p-2 bg-yellow-50 text-xs text-yellow-700 border border-yellow-100 rounded"><i class="fas fa-lightbulb mr-1"></i>⚠️ İpucu:Aynı konu veya kazanımdan birden fazla soru sorarsanız sistem bunları birlikte değerlendirir.</div><div id="questionsContainer" class="space-y-2 max-h-[300px] overflow-y-auto pr-2 custom-scrollbar"></div><button onclick="_0xCore.addQ()" class="mt-4 w-full py-2 border-2 border-dashed border-slate-300 rounded-lg text-slate-500 font-bold hover:border-blue-500 hover:text-blue-500 transition"><i class="fas fa-plus"></i> Soru Ekle</button></div></div></div>
<div id="section-entry" class="max-w-7xl mx-auto bg-white p-6 rounded-2xl shadow-sm border border-slate-200 hidden fade-in"><div class="flex flex-col md:flex-row justify-between items-start mb-6 gap-4"><div class="w-full md:w-2/3"><h2 class="text-xl font-bold text-slate-800">Not Girişi</h2><div class="mt-2 flex items-center gap-2"><select id="clsFltr" onchange="_0xCore.renderT()" class="border border-slate-300 rounded-lg p-2 text-sm font-bold text-slate-700 outline-none bg-white"><option value="">Tüm Sınıflar</option></select><button onclick="_0xCore.delC()" class="bg-red-50 text-red-600 hover:bg-red-100 px-3 py-2 rounded-lg text-sm font-bold border border-red-200 transition"><i class="fas fa-trash-alt mr-1"></i>Sınıfı Sil</button></div><div class="mt-2 p-3 bg-blue-50 border border-blue-100 rounded-lg text-sm text-blue-800 shadow-sm"><i class="fas fa-info-circle mr-1 text-blue-600"></i>⚠️ İpucu: Öğrencinin bulunabilmesi için numaranın başında mutlaka “No” söylemelisiniz.
Mikrofonu kullanarak “No 105” deyin ve notları girin.
Diğer öğrenciye geçmek için “No 345” demeniz yeterlidir.
İsterseniz not girişini klavye ile de yapabilirsiniz.</div></div><div class="w-full md:w-1/3 flex flex-col gap-2"><div class="flex items-center gap-2"><button id="btnVoice" onclick="_0xVoice.toggle()" class="w-full bg-white border-2 border-slate-200 text-slate-600 hover:border-red-400 hover:text-red-500 px-4 py-3 rounded-xl font-bold transition flex items-center justify-center shadow-sm"><i class="fas fa-microphone mr-2"></i> <span id="voiceStatusText">Mikrofonu Aç</span></button></div><div id="liveTranscript" class="text-xs text-slate-400 h-6 overflow-hidden text-center italic border-b border-dashed border-slate-200">...</div><div class="flex gap-2"><button onclick="_0xCore.clear()" class="flex-1 text-red-500 text-xs hover:bg-red-50 px-2 py-2 rounded-lg font-medium border border-red-100">Tümünü Sil</button><button onclick="_0xCore.save()" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-2 py-2 rounded-lg font-bold shadow-md transition text-xs"><i class="fas fa-check mr-1"></i> Kaydet</button></div></div></div><div class="overflow-x-auto border rounded-xl shadow-inner max-h-[600px] relative"><table class="min-w-full text-sm text-center text-gray-700"><thead class="text-xs text-slate-500 uppercase bg-slate-100 sticky top-0 z-30 shadow-sm"><tr id="tableHeaderRow"></tr></thead><tbody id="gradingTableBody" class="bg-white divide-y divide-slate-100"></tbody></table></div></div>
<div id="section-analysis" class="max-w-4xl mx-auto space-y-6 hidden fade-in"><div class="flex gap-4 no-print justify-center flex-wrap"><button onclick="_0xCore.genAnl()" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-xl shadow-lg font-bold transition"><i class="fas fa-sync-alt mr-2"></i> Yenile</button><button onclick="_0xCore.expW()" class="bg-blue-700 hover:bg-blue-800 text-white px-6 py-3 rounded-xl shadow-lg font-bold transition"><i class="fas fa-file-word mr-2"></i> Word İndir</button><button onclick="window.print()" class="bg-slate-800 hover:bg-slate-900 text-white px-6 py-3 rounded-xl shadow-lg font-bold transition"><i class="fas fa-print mr-2"></i> Yazdır / PDF</button></div><div id="printableReport" class="bg-white mx-auto shadow-xl rounded-xl"><div id="dashboardPage" class="p-8 border-b border-slate-200"><div class="text-center border-b-2 border-black pb-4 mb-6"><h1 class="text-3xl font-bold font-[Playfair Display] text-black mb-1" id="reportSchoolName">OKUL ADI</h1><h2 class="text-lg font-bold text-slate-700 uppercase" id="reportYear">EĞİTİM YILI</h2><h3 class="text-md font-medium text-slate-600 mt-1 uppercase" id="reportLesson">SINAV ANALİZ RAPORU</h3></div><div class="grid grid-cols-4 gap-4 mb-6"><div class="p-3 bg-blue-50 border border-blue-100 rounded text-center"><div class="text-xs text-blue-600 font-bold uppercase">Ortalama</div><div class="text-2xl font-bold text-blue-800" id="kpiAverage">0</div></div><div class="p-3 bg-green-50 border border-green-100 rounded text-center"><div class="text-xs text-green-600 font-bold uppercase">Başarı %</div><div class="text-2xl font-bold text-green-800" id="kpiSuccessRate">%0</div></div><div class="p-3 bg-purple-50 border border-purple-100 rounded text-center"><div class="text-xs text-purple-600 font-bold uppercase">En Yüksek</div><div class="text-2xl font-bold text-purple-800" id="kpiMax">0</div></div><div class="p-3 bg-slate-50 border border-slate-200 rounded text-center"><div class="text-xs text-slate-500 font-bold uppercase">Katılım</div><div class="text-2xl font-bold text-slate-700" id="kpiStudentCount">0</div></div></div><div class="grid grid-cols-2 gap-8 mb-6 no-break"><div><h4 class="text-sm font-bold uppercase border-b border-gray-300 mb-2">1. Not Dağılımı</h4><div class="h-40"><canvas id="chartDistribution"></canvas></div></div><div><h4 class="text-sm font-bold uppercase border-b border-gray-300 mb-2">2. Sınıf Başarısı</h4><div class="h-40"><canvas id="chartClasses"></canvas></div></div></div><div class="mb-6 no-break"><h4 class="text-sm font-bold uppercase border-b border-gray-300 mb-2">3. Kazanım Analizi</h4><table class="w-full text-xs text-left" border="1" style="border-collapse:collapse;width:100%;border-color:#e2e8f0"><thead class="bg-gray-100 font-bold"><tr><th class="p-2 border">Konu / Kazanım</th><th class="p-2 border text-center">Soru Sayısı</th><th class="p-2 border text-center">Başarı Oranı</th><th class="p-2 border text-center">Durum</th></tr></thead><tbody id="topicAnalysisBody"></tbody></table></div><div class="mb-8 no-break"><h4 class="text-sm font-bold uppercase border-b border-gray-300 mb-2">4. Değerlendirme</h4><p id="autoComment" class="text-sm text-justify font-serif text-gray-800 leading-relaxed"></p></div><div class="flex justify-end no-break"><div class="text-center w-48"><p class="font-bold text-gray-800 mb-8" id="signatureTeacher">Öğretmen</p><div class="border-t border-black pt-1 text-xs uppercase">Ders Öğretmeni</div></div></div></div><div id="sheetPage" class="p-8 page-break"><h2 class="text-xl font-bold text-center text-black mb-4">SINIF NOT ÇİZELGESİ</h2><table class="w-full text-xs text-center border-collapse border border-black" border="1"><thead class="bg-gray-100 font-bold" id="sheetHeader"></thead><tbody id="sheetBody"></tbody></table></div></div></div>
<div id="helpModal" class="modal-overlay" onclick="if(event.target===this)this.style.display='none'"><div class="modal-content"><h3 class="text-xl font-bold mb-4">Nasıl Kullanılır?</h3><div class="space-y-4 text-sm text-slate-600"><p><b>1. Kurulum:</b> Sınıf adını yazın, listeyi yapıştırın.</p><p><b>2. Not Girişi:</b> Sol üstten "Sınıf Seç" ile sınıfınızı filtreleyin. "Mikrofonu Aç" butonuna basın. <b>"No 105"</b> diyerek öğrenci seçin, puanları söyleyin.</p><p><b>3. Rapor:</b> Grafik destekli Word çıktısı alın.</p></div><button onclick="document.getElementById('helpModal').style.display='none'" class="mt-4 w-full bg-blue-600 text-white py-2 rounded font-bold">Tamam</button></div></div>
<script>
console.log('%c BU SİTE [Ö.S] TARAFINDAN TASARLANMIŞTIR.KOPYALANMASI YASAKTIR.HER HAKKI SAKLIDIR', 'color: red; background: #fff; font-size: 20px; font-weight: bold; padding: 10px; border: 2px solid red;');
const _0xCore=(function(){let _s=[],_q=[],_c={};const _DB='exam_pro_v8_data';const _sv=()=>{const d={students:_s,questions:_q,info:{school:document.getElementById('infoSchool').value,teacher:document.getElementById('infoTeacher').value,lesson:document.getElementById('infoLesson').value,year:document.getElementById('infoYear').value}};localStorage.setItem(_DB,JSON.stringify(d))};const _ld=()=>{const r=localStorage.getItem(_DB);if(r){const d=JSON.parse(r);_s=d.students||[];_q=d.questions||[];if(d.info){document.getElementById('infoSchool').value=d.info.school||"";document.getElementById('infoTeacher').value=d.info.teacher||"";document.getElementById('infoLesson').value=d.info.lesson||"";document.getElementById('infoYear').value=d.info.year||""}rc()}else{if(_q.length===0)addQBase()}};const rc=()=>{const c=[...new Set(_s.map(s=>s.className))].filter(x=>x);document.getElementById('addedClassesSummary').innerHTML=c.map(x=>`<span class="bg-blue-100 text-blue-800 text-xs font-bold px-2 py-1 rounded border border-blue-200">${x} (${_s.filter(s=>s.className===x).length})</span>`).join('');const sel=document.getElementById('clsFltr');const cv=sel.value;sel.innerHTML='<option value="">Tüm Sınıflar</option>'+c.map(x=>`<option value="${x}">${x}</option>`).join('');sel.value=cv};const calcT=()=>{const t=_q.reduce((a,b)=>a+(parseInt(b.points)||0),0);document.getElementById('totalPointsDisplay').innerText=t;return t};const addQBase=()=>{_q.push({id:1,topic:"",points:10});_sv()};return{init:function(){_ld();if(_q.length===0)addQBase();this.renderQ();calcT();this.show('setup')},show:function(id){['setup','entry','analysis'].forEach(s=>{document.getElementById('section-'+s).classList.add('hidden');const b=document.getElementById('nav-'+s);b.classList.replace('step-active','step-inactive');b.querySelector('.step-num').classList.replace('bg-blue-600','bg-slate-200');b.querySelector('.step-num').classList.replace('text-white','text-slate-600')});document.getElementById('section-'+id).classList.remove('hidden');const a=document.getElementById('nav-'+id);a.classList.replace('step-inactive','step-active');a.querySelector('.step-num').classList.replace('bg-slate-200','bg-blue-600');a.querySelector('.step-num').classList.replace('text-slate-600','text-white');if(id==='entry')this.renderT();if(id==='analysis')this.genAnl()},addSt:function(){const c=document.getElementById('batchClassName').value.trim();const t=document.getElementById('studentPasteArea').value.trim();if(!c){alert("Sınıf Adı Giriniz");return}if(!t){alert("Liste yapıştırınız");return}let cnt=0;t.split('\n').forEach(l=>{const m=l.trim().match(/^(\d+)\s+(.+)$/);if(m){const no=m[1],na=m[2];const ex=_s.find(x=>x.no==no);if(ex){ex.name=na;ex.className=c}else{_s.push({no,name:na,className:c,scores:{},total:0})}cnt++}});_sv();rc();document.getElementById('studentPasteArea').value='';alert("Eklendi: "+cnt)},delSt:function(no){if(confirm("Bu öğrenci silinsin mi?")){_s=_s.filter(x=>x.no!=no);_sv();this.renderT();rc()}},delC:function(){const v=document.getElementById('clsFltr').value;if(!v){alert("Silmek için listeden bir sınıf seçiniz.");return}if(confirm(v+" sınıfına ait tüm öğrenciler silinecek. Emin misiniz?")){_s=_s.filter(x=>x.className!==v);_sv();rc();this.renderT();alert("Sınıf silindi.")}},addQ:function(){_q.push({id:_q.length+1,topic:"",points:10});this.renderQ();_sv()},remQ:function(i){_q.splice(i,1);_q.forEach((q,k)=>q.id=k+1);this.renderQ();_sv()},updQ:function(i,f,v){_q[i][f]=v;calcT();_sv()},renderQ:function(){const c=document.getElementById('questionsContainer');c.innerHTML='';_q.forEach((q,i)=>{c.innerHTML+=`<div class="grid grid-cols-12 gap-2 items-center bg-white border border-slate-200 p-2 rounded-lg hover:shadow-md transition"><div class="col-span-1 text-center font-bold text-slate-400">S${q.id}</div><div class="col-span-8"><input type="text" value="${q.topic}" onchange="_0xCore.updQ(${i},'topic',this.value)" class="w-full bg-slate-50 border border-slate-200 rounded p-1.5 text-sm outline-none" placeholder="Konu..."></div><div class="col-span-2"><input type="number" value="${q.points}" onchange="_0xCore.updQ(${i},'points',parseInt(this.value))" class="w-full text-center bg-slate-50 border border-slate-200 rounded p-1.5 text-sm font-bold outline-none"></div><div class="col-span-1 text-center"><button onclick="_0xCore.remQ(${i})" class="text-slate-400 hover:text-red-500"><i class="fas fa-trash"></i></button></div></div>`});calcT()},renderT:function(){_s.sort((a,b)=>(a.className||"").localeCompare(b.className||"")||parseInt(a.no)-parseInt(b.no));const f=document.getElementById('clsFltr').value;const l=f?_s.filter(x=>x.className===f):_s;document.getElementById('tableHeaderRow').innerHTML=`<th class="px-4 py-3 text-left w-64 border-r sticky left-0 bg-slate-100 z-20">Öğrenci</th>${_q.map(q=>`<th class="w-16 border-r text-center"><div class="text-[10px] text-slate-400">S${q.id}</div><div>${q.points}p</div></th>`).join('')}<th class="px-4 py-3 w-20 sticky right-0 bg-slate-200 z-20 border-l">TOPLAM</th><th class="px-2 py-3 w-10 sticky right-0 bg-slate-200 z-20"></th>`;document.getElementById('gradingTableBody').innerHTML=l.map(s=>{let cc=_q.map(q=>`<td class="p-1 border-r border-slate-100"><input type="number" id="sc-${s.no}-${q.id}" data-max="${q.points}" value="${s.scores[q.id]!==undefined?s.scores[q.id]:''}" placeholder="S${q.id}" oninput="_0xCore.clcR('${s.no}')" class="w-full text-center outline-none font-bold text-slate-700 h-8 focus:bg-blue-50 rounded"></td>`).join('');return `<tr id="tr-${s.no}" class="border-b hover:bg-slate-50 group"><td class="px-4 py-2 text-left border-r border-slate-200 sticky left-0 bg-white group-hover:bg-slate-50 z-10"><div class="font-bold text-slate-700">${s.no}</div><div class="text-xs text-slate-500 truncate w-48">${s.name} <span class="bg-slate-100 px-1 rounded ml-1 text-[10px]">${s.className||'-'}</span></div></td>${cc}<td class="px-2 py-2 text-center font-bold text-lg border-l border-slate-200 sticky right-0 bg-slate-50 z-10" id="tot-${s.no}">${s.total}</td><td class="px-1 py-1 text-center border-l sticky right-0 bg-slate-50 z-10"><button onclick="_0xCore.delSt('${s.no}')" class="text-red-400 hover:text-red-600"><i class="fas fa-trash-alt"></i></button></td></tr>`}).join('')},clcR:function(no){const s=_s.find(x=>x.no==no);if(!s)return;let t=0;const sc={};_q.forEach(q=>{const i=document.getElementById(`sc-${no}-${q.id}`);let v=i.value;if(v!==''){v=parseFloat(v);const m=parseFloat(i.getAttribute('data-max'));if(v>m){v=m;i.value=m}if(v<0){v=0;i.value=0}sc[q.id]=v;t+=v}});s.scores=sc;s.total=t;const te=document.getElementById(`tot-${no}`);te.innerText=t;te.className=`px-2 py-2 text-center font-bold text-lg border-l border-slate-200 sticky right-0 z-10 ${t<50?'bg-red-50 text-red-600':'bg-green-50 text-green-700'}`},save:function(){_0xVoice.stop();_sv();try{this.genAnl();alert("Kaydedildi.")}catch(e){}},clear:function(){if(confirm("DİKKAT! Tüm veriler silinecek?")){localStorage.removeItem(_DB);location.reload()}},genAnl:function(){const g=_s.filter(s=>Object.keys(s.scores).length>0);if(g.length===0)return;const sc=g.map(s=>s.total);const avg=sc.reduce((a,b)=>a+b,0)/sc.length;const max=Math.max(...sc);const suc=sc.filter(s=>s>=50).length;document.getElementById('reportSchoolName').innerText=document.getElementById('infoSchool').value||"OKUL ADI";document.getElementById('signatureTeacher').innerText=document.getElementById('infoTeacher').value||"Öğretmen";document.getElementById('reportLesson').innerText=(document.getElementById('infoLesson').value||"DERS")+" - SINAV ANALİZİ";document.getElementById('reportYear').innerText=document.getElementById('infoYear').value;document.getElementById('kpiAverage').innerText=avg.toFixed(1);document.getElementById('kpiMax').innerText=max;document.getElementById('kpiStudentCount').innerText=g.length;document.getElementById('kpiSuccessRate').innerText='%'+Math.round((suc/g.length)*100);const ts={};_q.forEach(q=>{const n=q.topic.trim()||`Soru ${q.id}`;if(!ts[n])ts[n]={e:0,m:0,c:0};ts[n].m+=(q.points*g.length);ts[n].c+=1});g.forEach(s=>{_q.forEach(q=>{const n=q.topic.trim()||`Soru ${q.id}`;ts[n].e+=(s.scores[q.id]||0)})});const tb=document.getElementById('topicAnalysisBody');tb.innerHTML='';let wt=[];Object.keys(ts).forEach(t=>{const d=ts[t];const p=d.m===0?0:Math.round((d.e/d.m)*100);if(p<50)wt.push(t);tb.innerHTML+=`<tr class="border-b"><td class="p-2 border-r font-medium">${t}</td><td class="p-2 border-r text-center text-gray-500">${d.c} Soru</td><td class="p-2 border-r text-center font-bold ${p<50?'text-red-600':'text-green-600'}">%${p}</td><td class="p-2 text-center text-[10px] text-gray-500">${p<50?'Geliştirilmeli':'Kazanım Edinildi'}</td></tr>`});document.getElementById('sheetHeader').innerHTML=`<tr><th class="border border-black p-1">No</th><th class="border border-black p-1">Ad Soyad</th><th class="border border-black p-1">Sınıf</th>`+_q.map(q=>`<th class="border border-black p-1 w-8">S${q.id}</th>`).join('')+`<th class="border border-black p-1 bg-gray-200">PUAN</th></tr>`;document.getElementById('sheetBody').innerHTML=g.map(s=>`<tr><td class="border border-black p-1">${s.no}</td><td class="border border-black p-1 text-left px-2">${s.name}</td><td class="border border-black p-1">${s.className||'-'}</td>${_q.map(q=>`<td class="border border-black p-1">${s.scores[q.id]!==undefined?s.scores[q.id]:''}</td>`).join('')}<td class="border border-black p-1 font-bold ${s.total<50?'text-red-600':''}">${s.total}</td></tr>`).join('');const cls=[...new Set(g.map(s=>s.className).filter(c=>c))].join(', ');document.getElementById('autoComment').innerText=`    ${document.getElementById('infoYear').value} eğitim öğretim yılında yapılan ${document.getElementById('infoLesson').value} dersi sınavına ${cls} sınıflarından toplam ${g.length} öğrenci katılmıştır. Sınıf genel ortalaması ${avg.toFixed(1)} olarak gerçekleşmiştir. Başarı oranı %${Math.round((suc/g.length)*100)} düzeyindedir.\n`+(wt.length>0?`    Yapılan analiz sonucunda "${wt.join(', ')}" konularında eksiklikler tespit edilmiş olup telafi çalışmaları planlanmıştır.`:`    Tüm kazanımlarda hedeflenen başarı düzeyine ulaşılmıştır.`)+`\n    50 puan altında kalan ${g.length-suc} öğrenci için bireysel destek çalışmaları planlanmıştır.`;this.drCh(sc,g)},drCh:function(sc,st){const r=[0,0,0,0,0];sc.forEach(s=>{if(s<25)r[0]++;else if(s<50)r[1]++;else if(s<70)r[2]++;else if(s<85)r[3]++;else r[4]++});if(_c.d)_c.d.destroy();_c.d=new Chart(document.getElementById('chartDistribution'),{type:'bar',data:{labels:['0-24','25-49','50-69','70-84','85-100'],datasets:[{label:'Öğrenci',data:r,backgroundColor:['#ef4444','#f97316','#eab308','#3b82f6','#22c55e']}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}}}});const cs={};st.forEach(s=>{if(!s.className)return;if(!cs[s.className])cs[s.className]={s:0,c:0};cs[s.className].s+=s.total;cs[s.className].c++});const cl=Object.keys(cs),ca=cl.map(c=>(cs[c].s/cs[c].c).toFixed(1));if(_c.c)_c.c.destroy();_c.c=new Chart(document.getElementById('chartClasses'),{type:'bar',data:{labels:cl,datasets:[{label:'Ortalama',data:ca,backgroundColor:'rgba(59, 130, 246, 0.6)',borderColor:'rgba(59, 130, 246, 1)',borderWidth:2}]},options:{responsive:true,maintainAspectRatio:false,scales:{y:{beginAtZero:true,max:100}}}})},expW:function(){const title=document.getElementById('reportSchoolName').innerText;const year=document.getElementById('infoYear').value;const lesson=document.getElementById('infoLesson').value;const avg=document.getElementById('kpiAverage').innerText;const suc=document.getElementById('kpiSuccessRate').innerText;const max=document.getElementById('kpiMax').innerText;const cnt=document.getElementById('kpiStudentCount').innerText;const comm=document.getElementById('autoComment').innerText;const sign=document.getElementById('signatureTeacher').innerText;const ch1=document.getElementById('chartDistribution').toDataURL('image/png');const ch2=document.getElementById('chartClasses').toDataURL('image/png');const tBody=document.getElementById('topicAnalysisBody').innerHTML;const sHead=document.getElementById('sheetHeader').innerHTML;const sBody=document.getElementById('sheetBody').innerHTML;let h=`<html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word' xmlns='http://www.w3.org/TR/REC-html40'><head><meta charset='utf-8'><title>${title}</title><style>body{font-family:'Arial',sans-serif}table{border-collapse:collapse;width:100%;margin-bottom:20px}th,td{border:1px solid #000;padding:5px;text-align:center;font-size:10pt}th{background-color:#f0f0f0;font-weight:bold}h1,h2,h3{text-align:center;margin:5px}.stats-table td{border:none;padding:10px;text-align:center}.stats-box{border:1px solid #ccc;padding:10px;background:#f9f9f9}img{max-width:100%;height:auto}</style></head><body>`;h+=`<h1>${title}</h1><h2>${year} EĞİTİM YILI</h2><h3>${lesson} - SINAV ANALİZ RAPORU</h3><br>`;h+=`<table class="stats-table" width="100%"><tr><td width="25%"><div class="stats-box"><b>ORTALAMA</b><br><span style="font-size:16pt">${avg}</span></div></td><td width="25%"><div class="stats-box"><b>BAŞARI %</b><br><span style="font-size:16pt">${suc}</span></div></td><td width="25%"><div class="stats-box"><b>EN YÜKSEK</b><br><span style="font-size:16pt">${max}</span></div></td><td width="25%"><div class="stats-box"><b>KATILIM</b><br><span style="font-size:16pt">${cnt}</span></div></td></tr></table><br>`;h+=`<table width="100%" style="border:none"><tr><td style="border:none;vertical-align:top" width="50%"><h4>1. Not Dağılımı</h4><img src="${ch1}" width="300" height="150"></td><td style="border:none;vertical-align:top" width="50%"><h4>2. Sınıf Başarısı</h4><img src="${ch2}" width="300" height="150"></td></tr></table><br>`;h+=`<h4>3. Kazanım Analizi</h4><table width="100%"><thead><tr style="background:#eee"><th>Konu / Kazanım</th><th>Soru Sayısı</th><th>Başarı %</th><th>Durum</th></tr></thead><tbody>${tBody}</tbody></table><br>`;h+=`<h4>4. Değerlendirme</h4><p style="text-align:justify">${comm}</p><br><br>`;h+=`<div style="text-align:right;margin-right:50px"><b>${sign}</b><br>Ders Öğretmeni</div><br style="page-break-before:always">`;h+=`<h2>SINIF NOT ÇİZELGESİ</h2><table width="100%"><thead>${sHead}</thead><tbody>${sBody}</tbody></table></body></html>`;const b=new Blob(['\ufeff',h],{type:'application/msword'});const l=document.createElement('a');l.href=URL.createObjectURL(b);l.download='Sinav_Analiz_Raporu.doc';document.body.appendChild(l);l.click();document.body.removeChild(l);},getQ:function(){return _q},setS:function(id,idx,val){const s=_s.find(x=>x.no==id);if(s){s.scores[_q[idx].id]=val;this.clcR(id)}}}})();const _0xVoice=(function(){let r,is=false,cid=null,cix=0;if('webkitSpeechRecognition' in window){r=new webkitSpeechRecognition();r.continuous=true;r.interimResults=true;r.lang='tr-TR';r.onend=function(){if(is)setTimeout(()=>{try{r.start()}catch(e){}},500)};r.onerror=function(e){if(e.error==='not-allowed'){is=false;ui(false);alert("Mikrofon izni yok.")}}}const ui=(a)=>{const b=document.getElementById('btnVoice'),t=document.getElementById('voiceStatusText'),l=document.getElementById('liveTranscript');if(a){b.classList.add('mic-listening');t.innerText="Dinleniyor...";l.innerText="Konuşun..."}else{b.classList.remove('mic-listening');t.innerText="Mikrofonu Aç";l.innerText="..."}};const sp=(tx)=>{const u=new SpeechSynthesisUtterance(tx);u.lang='tr-TR';window.speechSynthesis.speak(u)};const hl=(no)=>{document.querySelectorAll('tr').forEach(t=>t.classList.remove('active-row'));const w=document.getElementById(`tr-${no}`);if(w){w.classList.add('active-row');w.scrollIntoView({behavior:'smooth',block:'center'});const i=w.querySelectorAll('input');if(i.length>0)i[0].focus()}};if(r){r.onresult=function(e){let itr='';for(let i=e.resultIndex;i<e.results.length;++i){const t=e.results[i][0].transcript.trim().toLowerCase();if(e.results[i].isFinal){document.getElementById('liveTranscript').innerText=t;if(t.includes("no")||t.includes("numara")){const m=t.match(/\d+/);if(m){cid=m[0];cix=0;hl(cid);sp(`${cid} seçildi.`)}}else if(cid){const ms=t.match(/\d+/g);if(ms&&ms.length>0){const q=_0xCore.getQ();ms.forEach(sc=>{if(cix<q.length){const qi=q[cix].id;const ip=document.getElementById(`sc-${cid}-${qi}`);if(ip){ip.value=sc;ip.dispatchEvent(new Event('input'));cix++}}})}if(t.includes("kaydet")||t.includes("tamam")){sp("Kaydedildi.");_0xCore.save()}}}else{itr+=t;document.getElementById('liveTranscript').innerText=itr}}}};return{toggle:function(){if(!r){alert("Tarayıcı desteklemiyor.");return}if(is)this.stop();else{try{r.start();is=true;ui(true)}catch(e){}}},stop:function(){if(r&&is){is=false;r.stop();ui(false)}}}})();window.onload=_0xCore.init;
</script>
</body>
</html>
